<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“š å’©å¦çš„è‹±è¯­ç‹å›½ - ç®€åŒ–ç‰ˆ (V11.0)</title>
    <style>
        /* --- æ•´ä½“å¸ƒå±€ä¸å…¬å…±æ ·å¼ (ä¿æŒ V10.5 é£æ ¼) --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #1a1a1a; 
            color: #e0e0e0; 
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background-color: #ffffff; 
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(255, 105, 180, 0.5); 
        }
        h1 {
            color: #ff69b4; 
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px #333;
        }
        h2 {
            color: #8a2be2; 
            border-left: 5px solid #ff69b4;
            padding-left: 10px;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        /* --- æ¨¡å¼é€‰æ‹©å™¨æ ·å¼ --- */
        .mode-selector {
            text-align: center;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        .mode-selector button {
            padding: 12px 15px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            border: 2px solid #ff69b4; 
            border-radius: 6px;
            transition: background-color 0.3s, transform 0.1s, color 0.3s;
            background-color: #2c3e50; 
            color: #ff69b4; 
        }
        .mode-selector button:hover {
            transform: translateY(-2px);
            background-color: #ff69b4; 
            color: #1a1a1a; 
        }
        .mode-selector button.active {
            background-color: #8a2be2;
            color: white;
            border-color: #8a2be2;
        }

        /* å­¦ä¹ ä¿¡æ¯åŒºåŸŸ (Summary) */
        #overallStudyInfo {
            text-align: center;
            margin: 10px auto 30px;
            padding: 15px;
            border: 2px solid #8a2be2;
            border-radius: 8px;
            background-color: #f7f7f7;
            color: #1a1a1a;
            font-weight: 500;
        }
        #overallStudyInfo button {
            padding: 8px 15px;
            font-size: 0.9em;
            background-color: #1a1a1a;
            color: #ff69b4;
            border: 2px solid #ff69b4;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            font-weight: bold;
            margin-left: 15px;
        }
        #overallStudyInfo button:hover {
            background-color: #ff69b4;
            color: #1a1a1a;
        }

        /* åˆ—è¡¨è§†å›¾æ ·å¼ */
        #listView table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-bottom: 30px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            color: #333; 
        }
        #listView th, #listView td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #f2f2f2;
        }
        #listView th {
            background-color: #1a1a1a; 
            color: #ff69b4; 
            font-weight: 700;
        }
        .learned-row {
            background-color: #e6e6fa !important; 
            opacity: 0.7;
        }
        .word-cell {
            font-weight: bold;
            color: #ff69b4; 
            cursor: pointer;
            transition: color 0.2s;
        }
        .word-cell:hover {
            color: #8a2be2; 
            text-decoration: underline;
        }
        .learn-btn {
            padding: 6px 10px;
            font-size: 12px;
            background-color: #8a2be2; 
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-weight: bold;
        }
        .learn-btn:hover {
            background-color: #ff69b4; 
        }

        /* --- é—ªå¡æ¨¡å¼æ ·å¼ (ä¿æŒä¸å˜) --- */
        .card-container {
            perspective: 1000px;
            width: 400px; 
            height: 250px; 
            margin: 30px auto;
        }
        .flashcard {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .flashcard.flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            border-radius: 12px;
            background-color: #fff0f5; 
            color: #1a1a1a;
            text-align: center;
        }
        .card-front {
            font-size: 2.5em;
            font-weight: 700;
            color: #ff69b4;
            border: 4px solid #8a2be2;
        }
        .card-back {
            transform: rotateY(180deg);
            align-items: flex-start;
            text-align: left;
            padding: 25px;
            font-size: 1em;
            line-height: 1.4;
            border: 4px solid #ff69b4;
        }
        .card-controls {
            text-align: center;
            margin-top: 20px;
        }
        .card-controls button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-weight: bold;
            background-color: #1a1a1a;
            color: white;
        }
        .card-controls button:hover {
            background-color: #8a2be2;
        }


        /* --- å¬å†™ã€å® ç‰©ã€Hangman å…±ç”¨æ ·å¼ --- */
        .quiz-area {
            max-width: 500px; 
            margin: 30px auto; 
            padding: 30px; 
            border-radius: 10px; 
            border: 3px solid #ff69b4; 
            background-color: #fff0f5; 
            color: #1a1a1a;
        }
        
        /* åŠäººå›¾å½¢æ ·å¼ (ä¿æŒä¸å˜) */
        #hangmanDrawing {
            width: 100px; 
            height: 120px; 
            margin: 20px auto 10px; 
            position: relative; 
            border-bottom: 4px solid #1a1a1a; 
        }
        #hangmanDrawing::before { 
            content: ''; position: absolute; left: 10px; bottom: 0; width: 4px; height: 110px; background-color: #1a1a1a;
        }
        #hangmanDrawing::after { 
            content: ''; position: absolute; left: 10px; top: 0; width: 50px; height: 4px; background-color: #1a1a1a;
        }
        .gallows-rope {
            position: absolute; left: 60px; top: 0; width: 2px; height: 20px; background-color: #1a1a1a;
        }
        .hangman-part {
            display: none; position: absolute; background-color: #1a1a1a; left: 60px;
        }
        .head { 
            width: 18px; height: 18px; border-radius: 50%; border: 2px solid #1a1a1a;
            top: 20px; margin-left: -10px; background-color: white; 
        }
        .body { 
            width: 2px; height: 30px; top: 42px;
        }
        .left-arm { 
            width: 18px; height: 2px; transform: rotate(45deg); transform-origin: right center; top: 45px; left: 45px; 
        }
        .right-arm { 
            width: 18px; height: 2px; transform: rotate(-45deg); transform-origin: left center; top: 45px; left: 60px; 
        }
        .left-leg { 
            width: 18px; height: 2px; transform: rotate(-45deg); transform-origin: right center; top: 70px; left: 45px; 
        }
        .right-leg { 
            width: 18px; height: 2px; transform: rotate(45deg); transform-origin: left center; top: 70px; left: 60px;
        }
        
        /* å­—æ¯æŒ‰é’®æ ·å¼ */
        #hangmanAlphabet button {
            padding: 8px 10px;
            margin: 3px;
            font-size: 1.1em;
            font-weight: bold;
            background-color: #f7f7f7;
            color: #1a1a1a;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.1s;
        }
        #hangmanAlphabet button:hover:not(:disabled) {
            background-color: #ff69b4;
            color: white;
        }
        #hangmanAlphabet button:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        #hangmanAlphabet button.correct {
            background-color: #2ecc71;
            color: white;
            border-color: #2ecc71;
        }
        #hangmanAlphabet button.incorrect {
            background-color: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }


        /* --- ç§»åŠ¨ç«¯ä¼˜åŒ– (ä¿æŒä¸å˜) --- */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { padding: 15px; }
            .mode-selector button { font-size: 12px; padding: 10px 12px; }
            #listView table, #listView thead, #listView tbody, #listView th, #listView td, #listView tr { display: block; }
            #listView tr { margin-bottom: 15px; border: 1px solid #f2f2f2; border-radius: 8px; overflow: hidden; }
            #listView td {
                border-bottom: 1px solid #f2f2f2; text-align: right; padding-left: 50%; position: relative;
                color: #333; 
            }
            #listView td::before {
                content: attr(data-label); position: absolute; left: 10px; width: 45%; padding-right: 10px; white-space: nowrap; font-weight: 600; color: #1a1a1a; text-align: left;
            }
            #listView th { display: none; }
            .card-container { width: 95%; height: 200px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“š å’©å¦çš„è‹±è¯­ç‹å›½ğŸ–¤ğŸ’–</h1>
        
        <div class="mode-selector">
            <button id="listViewBtn">ğŸ“ åˆ—è¡¨å­¦ä¹ æ¨¡å¼</button>
            <button id="flashcardBtn">ğŸƒ å¡ç‰‡ç¿»è½¬æ¨¡å¼</button>
            <button id="quizModeBtn">âœï¸ å¬å†™æµ‹è¯•æ¨¡å¼</button>
            <button id="matchModeBtn">ğŸ”— æ˜“æ··æ·†è¯é…å¯¹</button>
            <button id="dogGameBtn">ğŸ¶ å® ç‰©é¢†å…»æŒ‘æˆ˜</button>
            <button id="hangmanModeBtn">ğŸ”— å­—æ¯æ‹¼è¯ Hangman</button>
        </div>

        <div id="overallStudyInfo">
            **æ•´ä½“å­¦ä¹ æ¦‚è§ˆ**ï¼š
            <span id="overallSummary"></span>
            <button onclick="markAllAsNew()">
                é‡ç½®æ‰€æœ‰è¯æ±‡
            </button>
        </div>
        
        <div id="listView">
            <p style="text-align: center; color: #ff69b4; font-weight: 500;">**åˆ—è¡¨æ¨¡å¼ï¼šç‚¹å‡»è¡¨æ ¼ä¸­ç²—ä½“çš„è‹±æ–‡å•è¯ï¼Œå³å¯å¬åˆ°æ­£ç¡®çš„å‘éŸ³ï¼**</p>
            <div id="vocabulary-list"></div>
        </div>

        <div id="flashcardView" style="display: none;">
            <div class="card-container">
                <div class="flashcard" onclick="flipCard()">
                    <div class="card-face card-front" id="cardFront"></div>
                    <div class="card-face card-back" id="cardBack"></div>
                </div>
            </div>

            <div class="card-controls" style="margin-bottom: 20px;">
                <button id="pronounceCardBtn" onclick="speak(currentWordList[currentCardIndex].word)">ğŸ”Š å¬å‘éŸ³</button>
                <button id="prevCardBtn">â¬…ï¸ ä¸Šä¸€ä¸ª</button>
                <button id="nextCardBtn">ä¸‹ä¸€ä¸ª â¡ï¸</button>
                <button id="markLearnedCardBtn" class="learn-btn" onclick="markCardAsLearned()">âœ… å·²å­¦ä¼šï¼Œä¸å¤ä¹ </button>
            </div>
            <div class="card-info" style="color: #1a1a1a;">
                å½“å‰å•è¯ï¼š<span id="cardCount">1</span> / <span id="totalCards">0</span>
                <p id="cardCategory" style="font-size: 0.9em; margin-top: 5px;"></p>
            </div>
        </div>

        <div id="quizView" style="display: none; text-align: center; padding: 50px 20px;">
            <h2>âœï¸ å¬å†™ä¸æ‹¼å†™æµ‹è¯•</h2>
            <p id="quizCategory" style="color: #7f8c8d;">åˆ†ç±»ï¼š</p>
            <div class="quiz-area">
                <h3 id="quizInstruction">ç‚¹å‡»æŒ‰é’®å¬å•è¯ï¼š</h3>
                
                <button id="quizSpeakBtn">ğŸ”Š æ’­æ”¾å•è¯</button>
                <input type="text" id="quizInput" placeholder="åœ¨æ­¤è¾“å…¥æ‚¨å¬åˆ°çš„å•è¯">
                <button id="quizSubmitBtn">æäº¤ç­”æ¡ˆ</button>
                <p id="quizFeedback" style="font-weight: bold; margin-top: 20px; min-height: 20px;"></p>
            </div>
            
            <div class="quiz-score" style="margin-top: 30px; color: #1a1a1a;">
                <button id="quizNextBtn">ä¸‹ä¸€ä¸ªå•è¯ â¡ï¸</button>
                <p>å¾—åˆ†ï¼š<span id="scoreCorrect">0</span> / <span id="scoreTotal">0</span></p>
            </div>
        </div>

        <div id="matchView" style="display: none; padding: 20px;">
            <h2>ğŸ”— æ˜“æ··æ·†è¯é…å¯¹å­¦ä¹ </h2>
            <p style="text-align: center; color: #8a2be2; font-weight: 500;">æœ¬æ¨¡å¼åªæ˜¾ç¤ºåŒ…å«æ˜“æ··æ·†è¯çš„æ¡ç›®ã€‚ç‚¹å‡»å•è¯å¯å¬å–å‘éŸ³ã€‚</p>
            <div id="matchListContainer"></div>
        </div>

        <div id="dogGameView" style="display: none; text-align: center; padding: 50px 20px;">
            <h2>ğŸ¶ å® ç‰©é¢†å…»æŒ‘æˆ˜ï¼šæ‹¼å†™åˆé¤ï¼</h2>
            <div class="quiz-area dog-container">
                <h3 id="dogStatus">ğŸ‰ ä½ é¢†å…»äº†ä¸€åªå°ç‹—ï¼</h3>
                <div style="font-size: 2em; margin-bottom: 15px;">
                    ğŸš ç‹—ç²®ï¼š<span id="boneCount">0</span> ä»½
                </div>
                <div id="dogAvatar">ğŸ•</div>
                <p id="dogMood" style="font-style: italic;">å°ç‹—å¾ˆæœŸå¾…ä½ çš„æŒ‘æˆ˜ï¼</p>
                <hr style="border-top: 1px dashed #ff69b4; margin: 20px 0;">
                <h3 id="dogGameQuestion" style="min-height: 40px;">è¯·å›ç­”ï¼š</h3>
                <input type="text" id="dogGameInput" placeholder="åœ¨æ­¤è¾“å…¥è‹±æ–‡å•è¯æ‹¼å†™">
                <button id="dogGameSubmitBtn">æäº¤ç­”æ¡ˆ</button>
                <button id="dogGameNextBtn" style="display: none;">ä¸‹ä¸€é¢˜ â¡ï¸</button>
                <p id="dogGameFeedback" style="font-weight: bold; margin-top: 20px; min-height: 20px;"></p>
                <button id="memorizeWordBtn" onclick="toggleDogReview()" style="display: none;">ğŸ¶ å¸®æˆ‘è®°å•è¯ (æŸ¥çœ‹è¯¦æƒ…)</button>
                <div id="wordReviewArea" style="display: none;">
                    <p style="font-weight: bold;">ã€é”™è¯¯å›é¡¾ã€‘å°ç‹—å¸®ä½ å¼ºåŒ–è®°å¿†ï¼š</p>
                    <div id="reviewContent"></div>
                </div>
            </div>
        </div>

        <div id="hangmanView" style="display: none; text-align: center; padding: 20px;">
            <h2>ğŸ”— å­—æ¯æ‹¼è¯ï¼šHangman æ¸¸æˆ</h2>
            <div class="quiz-area hangman-container">
                <p id="hangmanQuestion" style="color: #8a2be2; font-weight: bold; font-size: 1.1em; min-height: 25px;">
                    ä¸­æ–‡é‡Šä¹‰ï¼š<span id="hangmanDef" style="color: #ff69b4;">(åŠ è½½ä¸­...)</span>
                </p>

                <div id="hangmanDrawing">
                    <span class="gallows-rope"></span>
                    <span id="h0" class="hangman-part head"></span>
                    <span id="h1" class="hangman-part body"></span>
                    <span id="h2" class="hangman-part left-arm"></span>
                    <span id="h3" class="hangman-part right-arm"></span>
                    <span id="h5" class="hangman-part right-leg"></span>
                    <span id="h4" class="hangman-part left-leg"></span>
                </div>

                <div id="hangmanWordDisplay" style="font-size: 2.5em; letter-spacing: 10px; margin: 20px 0; color: #8a2be2;">
                    _ _ _ _ _
                </div>

                <div id="hangmanFeedback" style="min-height: 20px; font-weight: bold; color: #1a1a1a; margin-bottom: 15px;">
                    ç‚¹å‡»å­—æ¯å¼€å§‹æ¸¸æˆï¼
                </div>

                <div id="hangmanControls" style="margin-bottom: 20px;">
                    <button id="hangmanPronounceBtn" class="hangman-control-btn" style="background-color: #ff69b4;">ğŸ”Š å¬å•è¯</button>
                    <button id="hangmanNewGameBtn" class="hangman-control-btn" style="background-color: #8a2be2;">é‡æ–°å¼€å§‹ â¡ï¸</button>
                </div>

                <div id="hangmanAlphabet" class="alphabet-container" style="max-width: 500px; margin: 0 auto;"></div>
            </div>
        </div>

    </div>

    <script>
        // --- æ ¸å¿ƒè¯æ±‡æ•°æ® (ä¿æŒä¸å˜) ---
        const vocabularyData = [
            { category: "ä¸€ã€ ç”Ÿç‰©ä¸èº«ä½“éƒ¨ä½ (Biology & Body Parts)", shortCategory: "ç”Ÿç‰©/èº«ä½“", words: [
                { word: "Gills", pos: "åè¯ (N.)", def: "é±¼é³ƒ", pron: "/gÉªlz/", example: "The fish breathes using its gills.", confusable: "Grills (çƒ¤æ¶)" },
                { word: "Leg", pos: "åè¯ (N.)", def: "è…¿", pron: "/lÉ›g/", example: "A horse has four legs.", confusable: "Lag (æ»å)" },
                { word: "Feathers", pos: "åè¯ (N.)", def: "ç¾½æ¯›", pron: "/ËˆfÉ›Ã°É™rz/", example: "The bird smoothed its feathers with its beak.", confusable: "Leather (çš®é©)" },
                { word: "Scales", pos: "åè¯ (N.)", def: "é±¼é³ï¼›åˆ»åº¦ï¼›å¤©å¹³", pron: "/skeÉªlz/", example: "Most fish are covered in scales.", confusable: "Sails (èˆ¹å¸†)" },
                { word: "Mouth", pos: "åè¯ (N.)", def: "å˜´å·´", pron: "/maÊŠÎ¸/", example: "Open your mouth and say 'Ah.'", confusable: "Mouse (è€é¼ )" }
            ]},
            { category: "äºŒã€ åŠ¨ç‰©ä¸è¡Œä¸º (Animals & Actions)", shortCategory: "åŠ¨ç‰©/è¡Œä¸º", words: [
                { word: "Eagle", pos: "åè¯ (N.)", def: "é¹°", pron: "/ËˆiËgÉ™l/", example: "The eagle soared high above the mountains.", confusable: "Eager (æ¸´æœ›çš„)" },
                { word: "Quietly", pos: "å‰¯è¯ (Adv.)", def: "å®‰é™åœ°ï¼›æ‚„æ‚„åœ°", pron: "/ËˆkwaÉªÉ™tli/", example: "She quietly opened the door.", confusable: "Quite (éå¸¸)" },
                { word: "Squawk", pos: "åŠ¨è¯ (V.)", def: "(é¸Ÿç±»ç­‰) å˜å˜åœ°å«ï¼›å°–å«", pron: "/skwÉ”Ëk/", example: "The parrot gave a loud squawk when the cat came near.", confusable: "Quake (éœ‡åŠ¨)" },
                { word: "Creeps", pos: "åŠ¨è¯ (V.)", def: "çˆ¬è¡Œï¼›è¹‘æ‰‹è¹‘è„šåœ°èµ°", pron: "/kriËps/", example: "The cat creeps through the tall grass.", confusable: "Crops (å†œä½œç‰©)" },
                { word: "Through", pos: "ä»‹è¯ (Prep.)", def: "ç©¿è¿‡ï¼›é€šè¿‡", pron: "/Î¸ruË/", example: "We drove through the tunnel.", confusable: "Threw (æ‰”çš„è¿‡å»å¼)" },
                { word: "Noise", pos: "åè¯ (N.)", def: "å™ªéŸ³ï¼›å–§å“—å£°", pron: "/nÉ”Éªz/", example: "The traffic created a lot of noise.", confusable: "Nose (é¼»å­)" },
                { word: "Right", pos: "å½¢å®¹è¯/å‰¯è¯ (Adj./Adv.)", def: "æ­£ç¡®çš„ï¼›å³è¾¹çš„ï¼›æ°å¥½", pron: "/raÉªt/", example: "You are right about the answer.", confusable: "Write (ä¹¦å†™)" },
                { word: "Scared", pos: "å½¢å®¹è¯ (Adj.)", def: "å®³æ€•çš„ï¼›ææƒ§çš„", pron: "/skÉ›rd/", example: "The mouse was scared of the cat.", confusable: "Scarred (æœ‰ç–¤ç—•çš„)" },
                { word: "Chases", pos: "åŠ¨è¯ (V.)", def: "è¿½é€ï¼›è¿½èµ¶", pron: "/ËˆtÊƒeÉªsÉªz/", example: "The dog chases the ball.", confusable: "Cheeses (å¥¶é…ª)" },
                { word: "Hurt", pos: "åŠ¨è¯ (V.)", def: "ä¼¤å®³ï¼›ç–¼ç—›", pron: "/hÉœËrt/", example: "I hurt my knee playing football.", confusable: "Heart (å¿ƒè„)" },
                { word: "Hunted", pos: "åŠ¨è¯ (V.)", def: "æ•çŒï¼›æœå¯»", pron: "/ËˆhÊŒntÉªd/", example: "The ancient people hunted for food.", confusable: "Hinder (é˜»ç¢)" },
                { word: "Escape", pos: "åŠ¨è¯ (V.)", def: "é€ƒè·‘ï¼›é€ƒè„±", pron: "/ÉªËˆskeÉªp/", example: "The bird escaped from the cage.", confusable: "Escapade (å†’é™©è¡Œä¸º)" }
            ]},
            { category: "ä¸‰ã€ æƒ…æ„Ÿä¸çŠ¶æ€ (Emotions & States)", shortCategory: "æƒ…æ„Ÿ/çŠ¶æ€", words: [
                { word: "Apart", pos: "å‰¯è¯ (Adv.)", def: "åˆ†å¼€åœ°ï¼›åˆ†ç¦»åœ°", pron: "/É™ËˆpÉ‘Ërt/", example: "The old building was torn apart.", confusable: "A part (ä¸€éƒ¨åˆ†)" },
                { word: "Always", pos: "å‰¯è¯ (Adv.)", def: "æ€»æ˜¯ï¼›ä¸€ç›´", pron: "/ËˆÉ”ËlweÉªz/", example: "I always drink coffee in the morning.", confusable: "All ways (æ‰€æœ‰æ–¹å¼)" },
                { word: "Nervous", pos: "å½¢å®¹è¯ (Adj.)", def: "ç´§å¼ çš„ï¼›ä¸å®‰çš„", pron: "/ËˆnÉœËrvÉ™s/", example: "She felt nervous before the big presentation.", confusable: "Nerve (ç¥ç»)" },
                { word: "Fierce", pos: "å½¢å®¹è¯ (Adj.)", def: "å‡¶çŒ›çš„ï¼›æ¿€çƒˆçš„", pron: "/fÉªÉ™rs/", example: "A tiger is a fierce predator.", confusable: "Pierce (åˆºç©¿)" },
                { word: "Solid", pos: "å½¢å®¹è¯ (Adj.)", def: "å›ºä½“çš„ï¼›åšå›ºçš„", pron: "/ËˆsÉ‘ËlÉªd/", example: "Ice is water in a solid state.", confusable: "Solemn (ä¸¥è‚ƒçš„)" },
                { word: "awful", pos: "å½¢å®¹è¯ (Adj.)", def: "ç³Ÿç³•çš„ï¼›å¯æ€•çš„", pron: "/ËˆÉ”ËfÉ™l/", example: "The weather was awful all day.", confusable: "Offal (å†…è„)" },
                { word: "safe", pos: "å½¢å®¹è¯ (Adj.)", def: "å®‰å…¨çš„", pron: "/seÉªf/", example: "Keep your valuables in a safe place.", confusable: "Save (ä¿å­˜)" },
                { word: "quiet", pos: "å½¢å®¹è¯ (Adj.)", def: "å®‰é™çš„", pron: "/ËˆkwaÉªÉ™t/", example: "The library is a quiet place.", confusable: "Quite (éå¸¸)" }
            ]},
            { category: "å››ã€ ç§‘å­¦ä¸ç¯å¢ƒ (Science & Environment)", shortCategory: "ç§‘å­¦/ç¯å¢ƒ", words: [
                { word: "Flow", pos: "åŠ¨è¯ (V.)", def: "æµåŠ¨", pron: "/floÊŠ/", example: "Water flows downhill.", confusable: "Floor (åœ°æ¿)" },
                { word: "Winter", pos: "åè¯ (N.)", def: "å†¬å¤©", pron: "/ËˆwÉªntÉ™r/", example: "It snows a lot in winter.", confusable: "Wander (æ¼«æ­¥)" },
                { word: "Steam", pos: "åè¯ (N.)", def: "è’¸æ±½", pron: "/stiËm/", example: "Steam rose from the hot cup of tea.", confusable: "Stream (æºªæµ)" },
                { word: "melt", pos: "åŠ¨è¯ (V.)", def: "èåŒ–", pron: "/mÉ›lt/", example: "The ice cream will melt in the sun.", confusable: "Mailed (é‚®å¯„çš„è¿‡å»å¼)" },
                { word: "heat", pos: "åè¯/åŠ¨è¯ (N./V.)", def: "çƒ­é‡ï¼›åŠ çƒ­", pron: "/hiËt/", example: "The sun provides light and heat.", confusable: "Hit (å‡»æ‰“)" },
                { word: "mixture", pos: "åè¯ (N.)", def: "æ··åˆç‰©", pron: "/ËˆmÉªkstÊƒÉ™r/", example: "The cake batter is a mixture of flour, eggs, and sugar.", confusable: "Mixture (æ··åˆ)" },
                { word: "melted", pos: "å½¢å®¹è¯ (Adj.)", def: "èåŒ–äº†çš„", pron: "/ËˆmÉ›ltÉªd/", example: "The melted butter soaked into the toast.", confusable: "Metal (é‡‘å±)" },
                { word: "liquid", pos: "åè¯ (N.)", def: "æ¶²ä½“", pron: "/ËˆlÉªkwÉªd/", example: "Water is a clear liquid.", confusable: "Lick it (èˆ”å®ƒ)" },
                { word: "freezer", pos: "åè¯ (N.)", def: "å†°æŸœï¼›å†·å†»å®¤", pron: "/ËˆfriËzÉ™r/", example: "Put the ice cream back in the freezer.", confusable: "Frisker (æœèº«è€…)" },
                { word: "salt", pos: "åè¯ (N.)", def: "ç›", pron: "/sÉ”Ëlt/", example: "Don't put too much salt in the soup.", confusable: "Sort (ç§ç±»)" }
            ]},
            { category: "äº”ã€ äº¤é€šä¸åœ°ç† (Transportation & Geography)", shortCategory: "äº¤é€š/åœ°ç†", words: [
                { word: "Australia", pos: "åè¯ (N.)", def: "æ¾³å¤§åˆ©äºš", pron: "/É”ËËˆstreÉªliÉ™/", example: "Australia is famous for its kangaroos.", confusable: "Austria (å¥¥åœ°åˆ©)" },
                { word: "Egypt", pos: "åè¯ (N.)", def: "åŸƒåŠ", pron: "/ËˆiËdÊ’Éªpt/", example: "The pyramids are in Egypt.", confusable: "Eject (å–·å°„)" },
                { word: "Cable", pos: "åè¯ (N.)", def: "ç”µç¼†ï¼›é’¢ç¼†", pron: "/ËˆkeÉªbÉ™l/", example: "We need a new charging cable.", confusable: "Cabal (é˜´è°‹)" },
                { word: "Truck", pos: "åè¯ (N.)", def: "å¡è½¦ (ç¾å¼)", pron: "/trÊŒk/", example: "The truck carried heavy goods.", confusable: "Trick (è¯¡è®¡)" },
                { word: "horse", pos: "åè¯ (N.)", def: "é©¬", pron: "/hÉ”Ërs/", example: "She learned to ride a horse.", confusable: "Hoarse (æ²™å“‘çš„)" },
                { word: "ship", pos: "åè¯ (N.)", def: "èˆ¹ï¼›èˆ°", pron: "/ÊƒÉªp/", example: "The cargo ship sailed across the ocean.", confusable: "Sheep (ç»µç¾Š)" },
                { word: "ocean", pos: "åè¯ (N.)", def: "æµ·æ´‹", pron: "/ËˆoÊŠÊƒÉ™n/", example: "The Pacific is the largest ocean.", confusable: "Ozone (è‡­æ°§)" },
                { word: "world", pos: "åè¯ (N.)", def: "ä¸–ç•Œ", pron: "/wÉœËrld/", example: "The world is round.", confusable: "Whirled (æ—‹è½¬çš„è¿‡å»å¼)" },
                { word: "train", pos: "åè¯ (N.)", def: "ç«è½¦", pron: "/treÉªn/", example: "I took the train to the city.", confusable: "Drain (æ’æ°´)" },
                { word: "airplane", pos: "åè¯ (N.)", def: "é£æœº", pron: "/ËˆÉ›É™rpleÉªn/", example: "The airplane took off on time.", confusable: "Air plan (ç©ºä¸­è®¡åˆ’)" }
            ]},
            { category: "å…­ã€ é€šä¿¡ä¸æŠ€æœ¯ (Communication & Technology)", shortCategory: "é€šä¿¡/æŠ€æœ¯", words: [
                { word: "apostrophe", pos: "åè¯ (N.)", def: "æ’‡å· ( ' )", pron: "/É™ËˆpÉ‘ËstrÉ™fi/", example: "We use an apostrophe in contractions like don't.", confusable: "Apostate (å›æ•™è€…)" },
                { word: "contraction", pos: "åè¯ (N.)", def: "ç¼©å†™è¯ï¼›æ”¶ç¼©", pron: "/kÉ™nËˆtrÃ¦kÊƒÉ™n/", example: "It's is a contraction of it is.", confusable: "Contact (è”ç³»)" },
                { word: "communication", pos: "åè¯ (N.)", def: "äº¤æµï¼›é€šä¿¡", pron: "/kÉ™ËŒmjuËnÉªËˆkeÉªÊƒÉ™n/", example: "Good communication is important in a team.", confusable: "Communion (åœ£é¤)" },
                { word: "information", pos: "åè¯ (N.)", def: "ä¿¡æ¯ï¼›èµ„æ–™", pron: "/ËŒÉªnfÉ™rËˆmeÉªÊƒÉ™n/", example: "The website provides useful information.", confusable: "Formation (å½¢æˆ)" },
                { word: "textmessages", pos: "åè¯ (N.)", def: "æ‰‹æœºçŸ­ä¿¡", pron: "/ËˆtÉ›kstËŒmÉ›sÉªdÊ’Éªz/", example: "I sent him several textmessages yesterday.", confusable: "Textile (çººç»‡å“)" },
                { word: "text", pos: "åè¯ (N.)", def: "æ–‡æœ¬ï¼›æ­£æ–‡", pron: "/tÉ›kst/", example: "The text of the email was very long.", confusable: "Test (æµ‹è¯•)" },
                { word: "send", pos: "åŠ¨è¯ (V.)", def: "å‘é€ï¼›å¯„å‡º", pron: "/sÉ›nd/", example: "Please send the file via email.", confusable: "Sent (å‘é€çš„è¿‡å»å¼)" },
                { word: "internet", pos: "åè¯ (N.)", def: "äº’è”ç½‘", pron: "/ËˆÉªntÉ™rnÉ›t/", example: "I found the answer on the internet.", confusable: "Internal (å†…éƒ¨çš„)" },
                { word: "communicate", pos: "åŠ¨è¯ (V.)", def: "äº¤æµï¼›é€šä¿¡", pron: "/kÉ™ËˆmjuËnÉªkeÉªt/", example: "We communicate via email.", confusable: "Commute (é€šå‹¤)" }
            ]},
            { category: "ä¸ƒã€ æ—¥å¸¸ä¸é¥®é£Ÿ (Daily Life & Food)", shortCategory: "æ—¥å¸¸/é¥®é£Ÿ", words: [
                { word: "juice", pos: "åè¯ (N.)", def: "æœæ±", pron: "/dÊ’uËs/", example: "I like to drink orange juice for breakfast.", confusable: "Loose (æ¾çš„)" },
                { word: "cafeteria", pos: "åè¯ (N.)", def: "è‡ªåŠ©é¤å…ï¼›é£Ÿå ‚", pron: "/ËŒkÃ¦fÉªËˆtÉªÉ™riÉ™/", example: "We eat lunch in the school cafeteria.", confusable: "Caffeine (å’–å•¡å› )" },
                { word: "vanilla", pos: "åè¯ (N.)", def: "é¦™è‰ (å£å‘³)", pron: "/vÉ™ËˆnÉªlÉ™/", example: "My favorite ice cream flavor is vanilla.", confusable: "Venal (è´ªè´¢çš„)" },
                { word: "friends", pos: "åè¯ (N.)", def: "æœ‹å‹ä»¬", pron: "/frÉ›ndz/", example: "I went to the park with my friends.", confusable: "Fiends (æ¶é­”)" },
                { word: "taking", pos: "åŠ¨è¯ (V.)", def: "æ‹¿ï¼›å¸¦ï¼›å ç”¨ (ç°åœ¨åˆ†è¯)", pron: "/ËˆteÉªkÉªÅ‹/", example: "She is taking a photo.", confusable: "Talking (è¯´è¯)" },
                { word: "our", pos: "ä»£è¯ (Pron.)", def: "æˆ‘ä»¬çš„", pron: "/aÊŠr/", example: "This is our house.", confusable: "Hour (å°æ—¶)" }
            ]},
            { category: "å…«ã€ æŠ½è±¡ä¸å…¶ä»– (Abstract & Other)", shortCategory: "æŠ½è±¡/å…¶ä»–", words: [
                { word: "dictionary", pos: "åè¯ (N.)", def: "å­—å…¸ï¼›è¯å…¸", pron: "/ËˆdÉªkÊƒÉ™neri/", example: "Look up the word in the dictionary.", confusable: "Dictation (å¬å†™)" },
                { word: "alphabetical", pos: "å½¢å®¹è¯ (Adj.)", def: "å­—æ¯é¡ºåºçš„", pron: "/ËŒÃ¦lfÉ™ËˆbetÉªkÉ™l/", example: "Sort the names in alphabetical order.", confusable: "Alphabet (å­—æ¯è¡¨)" },
                { word: "joined", pos: "åŠ¨è¯ (V.)", def: "è¿æ¥ï¼›åŠ å…¥ (è¿‡å»å¼/è¿‡å»åˆ†è¯)", pron: "/dÊ’É”Éªnd/", example: "The two wires were joined together.", confusable: "Joint (å…³èŠ‚)" },
                { word: "couldn't", pos: "ç¼©å†™ (Contr.)", def: "could not (ä¸èƒ½)", pron: "/ËˆkÊŠdÉ™nt/", example: "I couldn't open the door because it was locked.", confusable: "Shouldn't (ä¸åº”è¯¥)" },
                { word: "Traveled", pos: "åŠ¨è¯ (V.)", def: "æ—…è¡Œäº† (ç¾å¼æ‹¼å†™)", pron: "/ËˆtrÃ¦vÉ™ld/", example: "They traveled across Europe last summer.", confusable: "Travelled (è‹±å¼æ‹¼å†™)" },
                { word: "Order", pos: "åè¯/åŠ¨è¯ (N./V.)", def: "é¡ºåºï¼›å‘½ä»¤ï¼›ç‚¹é¤", pron: "/ËˆÉ”ËrdÉ™r/", example: "Put the books in alphabetical order.", confusable: "Odour (æ°”å‘³)" },
                { word: "From", pos: "ä»‹è¯ (Prep.)", def: "ä»...ï¼›æ¥è‡ª...", pron: "/frÊŒm/", example: "This gift is from my aunt.", confusable: "Form (å½¢å¼)" },
                { word: "Ltaly", pos: "ä¸“æœ‰åè¯ (N.)", def: "æ„å¤§åˆ© (é”™è¯¯æ‹¼å†™)", pron: "/ËˆÉªtÉ™li/", example: "Ltaly is famous for its pizza. (åº”ä¸ºItaly)", confusable: "Italy (æ„å¤§åˆ©)" }
            ]},
            { category: "ä¹ã€ äººåä¸åœ°å (Names & Places)", shortCategory: "äººå/åœ°å", words: [
                { word: "London", pos: "ä¸“æœ‰åè¯ (N.)", def: "ä¼¦æ•¦", pron: "/ËˆlÊŒndÉ™n/", example: "London is the capital of England.", confusable: "Linden (è©ææ ‘)" },
                { word: "Henry", pos: "ä¸“æœ‰åè¯ (N.)", def: "äººå (äº¨åˆ©)", pron: "/ËˆhÉ›nri/", example: "Henry is a common English name.", confusable: "Hennery (å…»é¸¡åœº)" },
                { word: "Leo", pos: "ä¸“æœ‰åè¯ (N.)", def: "ç‹®å­åº§ï¼›äººå (åˆ©å¥¥)", pron: "/ËˆliËoÊŠ/", example: "Leo is my brother's name.", confusable: "Liaw (å§“æ°)" },
                { word: "Lucia", pos: "ä¸“æœ‰åè¯ (N.)", def: "äººå (éœ²è¥¿äºš)", pron: "/luËËˆsiËÉ™/", example: "Lucia is a beautiful name.", confusable: "Loose hair (æ¾æ•£çš„å¤´å‘)" },
                { word: "Ellis", pos: "ä¸“æœ‰åè¯ (N.)", def: "äººå/åœ°å (åŸƒåˆ©æ–¯)", pron: "/ËˆÉ›lÉªs/", example: "Ellis Island is famous in New York.", confusable: "Alice (çˆ±ä¸½ä¸)" },
                { word: "United", pos: "å½¢å®¹è¯ (Adj.)", def: "è”åˆçš„ï¼›ç»Ÿä¸€çš„", pron: "/juËËˆnaÉªtÉªd/", example: "The United States is a big country.", confusable: "Untied (è§£å¼€çš„)" },
                { word: "Cool", pos: "å½¢å®¹è¯ (Adj.)", def: "é…·çš„ï¼›å‡‰çˆ½çš„", pron: "/kuËl/", example: "That's a cool shirt.", confusable: "Coal (ç…¤)" },
                { word: "Trip", pos: "åè¯ (N.)", def: "æ—…è¡Œï¼›ç»Šå€’", pron: "/trÉªp/", example: "We are planning a weekend trip to the mountains.", confusable: "Trap (é™·é˜±)" },
                { word: "Awesome", pos: "å½¢å®¹è¯ (Adj.)", def: "æå¥½çš„ï¼›ä»¤äººæ•¬ç•çš„", pron: "/ËˆÉ”ËsÉ™m/", example: "That concert was awesome.", confusable: "Ostrich (é¸µé¸Ÿ)" }
            ]},
            { category: "åã€ å…¶ä»– (Others)", shortCategory: "å…¶ä»–", words: [
                { word: "Luckily", pos: "å‰¯è¯ (Adv.)", def: "å¹¸è¿åœ°", pron: "/ËˆlÊŒkÉªli/", example: "Luckily, we found a parking spot right away.", confusable: "Likely (å¯èƒ½åœ°)" },
                { word: "third", pos: "å½¢å®¹è¯ (Adj.)", def: "ç¬¬ä¸‰çš„", pron: "/Î¸ÉœËrd/", example: "She won the third prize in the competition.", confusable: "Thirst (å£æ¸´)" },
                { word: "later", pos: "å‰¯è¯ (Adv.)", def: "ç¨åï¼›ä»¥å", pron: "/ËˆleÉªtÉ™r/", example: "I will call you later.", confusable: "Latter (åè€…)" },
                { word: "letter", pos: "åè¯ (N.)", def: "ä¿¡ä»¶ï¼›å­—æ¯", pron: "/ËˆlÉ›tÉ™r/", example: "She wrote a letter to her friend.", confusable: "Litter (åƒåœ¾)" },
                { word: "Clerks", pos: "åè¯ (N.)", def: "èŒå‘˜ï¼›åº—å‘˜", pron: "/klÉœËrks/", example: "The clerks at the store were very helpful.", confusable: "Clocks (æ—¶é’Ÿ)" },
                { word: "island", pos: "åè¯ (N.)", def: "å²›å±¿", pron: "/ËˆaÉªlÉ™nd/", example: "They visited a beautiful tropical island.", confusable: "Iceland (å†°å²›)" },
                { word: "scared", pos: "å½¢å®¹è¯ (Adj.)", def: "å®³æ€•çš„", pron: "/skÉ›rd/", example: "He was scared of the dark.", confusable: "Scarred (æœ‰ç–¤ç—•çš„)" }
            ]}
        ];


        // --- V11.0 ç®€åŒ–åçš„å…¨å±€å˜é‡ ---
        const STORAGE_KEY = 'mienius_vocab_status_v4'; // æ›´æ–°å­˜å‚¨é”®
        
        let wordStatusMap = {}; // Key: word, Value: 'new' or 'learned'
        let allWordsFlat = []; // æ‰€æœ‰è¯æ±‡çš„æ‰å¹³åŒ–åˆ—è¡¨ï¼ˆåŒ…å«çŠ¶æ€ï¼‰
        let currentWordList = []; // å½“å‰æ¨¡å¼ä½¿ç”¨çš„è¯æ±‡åˆ—è¡¨ï¼ˆæœªå­¦ä¼šçš„è¯æ±‡ï¼‰
        
        // --- æ¸¸æˆ/å¡ç‰‡æ¨¡å¼æ‰€éœ€å˜é‡ (ä¿æŒä¸å˜) ---
        let currentCardIndex = 0;
        let scoreCorrect = 0;
        let scoreTotal = 0;
        let dogBones = 0;
        let dogQuizList = [];
        let dogQuizIndex = -1;
        let currentDogWord = null;
        let dogGameErrorCount = 0;
        let dogGameReviewWord = null;
        let hangmanTargetWord = '';
        let hangmanDef = '';
        let hangmanMistakes = 0;
        let hangmanGuessedLetters = new Set();
        const ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
        const HANGMAN_MAX_MISTAKES = 6;
        const HANGMAN_PARTS_IDS = ['h0', 'h1', 'h2', 'h3', 'h4', 'h5'];
        
        // ç”¨äºè®°å½•å½“å‰è§†å›¾ID
        let currentViewId = 'listView'; 
        
        
        // --- å…¬å…±å·¥å…·å‡½æ•° (ä¿æŒä¸å˜) ---

        const speak = (text) => {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel(); 
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US'; 
                utterance.rate = 0.85; 
                speechSynthesis.speak(utterance);
            } else {
                alert('æŠ±æ­‰ï¼Œæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³æœ—è¯»åŠŸèƒ½ã€‚');
            }
        };

        const showView = (viewId) => {
            ['listView', 'flashcardView', 'quizView', 'matchView', 'dogGameView', 'hangmanView'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = (id === viewId ? 'block' : 'none');
            });
            speechSynthesis.cancel();
            
            document.querySelectorAll('.mode-selector button').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = document.getElementById(viewId.replace('View', 'Btn'));
            if(activeBtn) activeBtn.classList.add('active');
            
            currentViewId = viewId;
        };


        // --- æ ¸å¿ƒåŠŸèƒ½ï¼šå•è¯çŠ¶æ€ç®¡ç† (ç®€åŒ–) ---

        const loadWordStatus = () => {
            try {
                const storedStatus = localStorage.getItem(STORAGE_KEY);
                if (storedStatus) {
                    wordStatusMap = JSON.parse(storedStatus);
                }
            } catch (e) {
                console.error("æ— æ³•åŠ è½½æ•°æ®:", e);
                wordStatusMap = {};
            }
        };

        const saveWordStatus = () => {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(wordStatusMap));
            } catch (e) {
                console.error("æ— æ³•ä¿å­˜æ•°æ®:", e);
            }
        };
        
        /**
         * åˆ·æ–°å½“å‰æ¿€æ´»çš„æ¨¡å¼çš„UIæ•°æ®
         */
        const refreshCurrentMode = () => {
            // é‡æ–°åˆå§‹åŒ– currentWordList (æœªå­¦ä¼šçš„è¯æ±‡)
            currentWordList = allWordsFlat.filter(w => w.status === 'new');
            updateOverallSummary();
            
            const viewId = currentViewId;
            if (viewId === 'listView') {
                renderVocabularyList();
            } else if (viewId === 'flashcardView') {
                initFlashcardMode();
            } else if (viewId === 'quizView') {
                initQuizMode();
            } else if (viewId === 'matchView') {
                initMatchMode();
            } else if (viewId === 'dogGameView') {
                initDogGame();
            } else if (viewId === 'hangmanView') {
                initHangmanGame();
            }
        }


        const markAsLearned = (word, isLearned = true) => {
            word = word.trim();
            const newStatus = isLearned ? 'learned' : 'new';
            wordStatusMap[word] = newStatus;
            saveWordStatus();
            
            // 1. å¼ºåˆ¶åˆ·æ–°å…¨å±€æ‰å¹³åŒ–åˆ—è¡¨çš„çŠ¶æ€
            flattenAndInitializeWords();
            
            // 2. åˆ·æ–°æ‰€æœ‰æ¨¡å¼çš„æ•°æ®å’Œ UI
            refreshCurrentMode();
        };

        const markAllAsNew = () => {
            if (confirm("ç¡®å®šè¦é‡ç½®æ‰€æœ‰å•è¯çš„çŠ¶æ€å—ï¼Ÿæ‰€æœ‰è¯æ±‡éƒ½å°†é‡æ–°è¿›å…¥å­¦ä¹ é˜Ÿåˆ—ï¼")) {
                wordStatusMap = {}; 
                saveWordStatus();
                alert("æ‰€æœ‰å•è¯çŠ¶æ€å·²é‡ç½®ï¼è¯·åˆ·æ–°é¡µé¢ä»¥åº”ç”¨æ–°çŠ¶æ€ã€‚");
                window.location.reload(); 
            }
        };

        // æ‰å¹³åŒ–æ‰€æœ‰è¯æ±‡ï¼Œå¹¶åº”ç”¨çŠ¶æ€
        const flattenAndInitializeWords = () => {
            allWordsFlat = [];
            vocabularyData.forEach(cat => {
                cat.words.forEach(wordObj => {
                    const word = wordObj.word.trim();
                    const status = wordStatusMap[word] || 'new'; 
                    
                    allWordsFlat.push({ 
                        ...wordObj, 
                        category: cat.shortCategory,
                        status: status
                    });
                });
            });
            // æ¯æ¬¡åˆ·æ–°éƒ½æ›´æ–° currentWordList (æœªå­¦ä¼šçš„)
            currentWordList = allWordsFlat.filter(w => w.status === 'new');
            return allWordsFlat.length;
        };
        
        // æ ¸å¿ƒåŠŸèƒ½ï¼šæ›´æ–°é¡¶éƒ¨çš„å­¦ä¹ ä¿¡æ¯æ‘˜è¦
        const updateOverallSummary = () => {
            const totalCount = allWordsFlat.length;
            const unlearnedCount = currentWordList.length;
            const learnedCount = totalCount - unlearnedCount;

            const summaryElement = document.getElementById('overallSummary');
            if (summaryElement) {
                summaryElement.innerHTML = `
                    æ€»è¯æ±‡: <strong style="color: #8a2be2;">${totalCount}</strong> è¯ 
                    | å¾…å­¦ä¹ : <strong style="color: #ff69b4;">${unlearnedCount}</strong> è¯
                    | å·²å­¦ä¼š: <strong style="color: #2ecc71;">${learnedCount}</strong> è¯
                `;
            }
        };
        

        // --- 1. åˆ—è¡¨è§†å›¾åŠŸèƒ½ ---
        const renderVocabularyList = () => {
            const container = document.getElementById('vocabulary-list');
            if (!container) return;
            
            // åˆ—è¡¨æ¨¡å¼æ˜¾ç¤ºæ‰€æœ‰è¯æ±‡ (allWordsFlat)
            const wordsToShow = allWordsFlat;

            if (wordsToShow.length === 0) {
                 container.innerHTML = `<p style="text-align: center; color: #8a2be2; font-weight: bold;">è¯æ±‡åˆ—è¡¨ä¸ºç©ºã€‚</p>`;
                 return;
            }

            let html = `<h2>å…¨éƒ¨è¯æ±‡åˆ—è¡¨ (${wordsToShow.length} è¯)</h2>`;
            html += ` <table> <thead><tr><th>å•è¯ (Word)</th><th>è¯æ€§ (P.O.S)</th><th>ä¸­æ–‡é‡Šä¹‰</th><th>å‘éŸ³ (IPA)</th><th>æ˜“æ··æ·†è¯ (Confusable)</th><th class="action-col">æ“ä½œ</th></tr></thead> <tbody> `; 
            
            wordsToShow.forEach(wordObj => {
                const cleanWord = wordObj.word.replace(/'/g, "\\'");
                const isLearned = wordObj.status === 'learned';
                
                const rowClass = isLearned ? 'learned-row' : '';
                const buttonText = isLearned ? 'âŒ å–æ¶ˆæ ‡è®°' : 'âœ… æ ‡è®°ä¸ºå·²å­¦ä¼š';
                // åˆ—è¡¨ä¸­çš„æŒ‰é’®ç›´æ¥è°ƒç”¨ markAsLearned
                const buttonAction = isLearned ? `markAsLearned('${cleanWord}', false)` : `markAsLearned('${cleanWord}')`;

                html += ` 
                <tr class="${rowClass}"> 
                    <td class="word-cell" data-label="å•è¯" onclick="speak('${cleanWord}')">${wordObj.word}</td> 
                    <td class="pos" data-label="è¯æ€§">${wordObj.pos}</td> 
                    <td data-label="ä¸­æ–‡é‡Šä¹‰">${wordObj.def}</td> 
                    <td class="pron" data-label="å‘éŸ³">${wordObj.pron}</td> 
                    <td data-label="æ˜“æ··æ·†è¯">${wordObj.confusable || '-'}</td> 
                    <td class="action-col" data-label="æ“ä½œ">
                        <button class="learn-btn" onclick="${buttonAction}">${buttonText}</button>
                    </td>
                </tr> `;
            });
            html += `</tbody></table>`;
            container.innerHTML = html;
        };


        // --- 2. ç¿»è½¬å¡ç‰‡å­¦ä¹ åŠŸèƒ½ ---

        const prepareFlashcards = () => {
            // currentWordList å·²ç»æ˜¯æœªå­¦çš„è¯æ±‡
            // éšæœºæ‰“ä¹±è¯æ±‡é¡ºåº
            for (let i = currentWordList.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [currentWordList[i], currentWordList[j]] = [currentWordList[j], currentWordList[i]];
            }
            
            currentCardIndex = 0;
            const totalCardsElement = document.getElementById('totalCards');
            const markLearnedBtn = document.getElementById('markLearnedCardBtn');
            const cardFront = document.getElementById('cardFront');
            const cardBack = document.getElementById('cardBack');
            const cardCount = document.getElementById('cardCount');
            const cardCategory = document.getElementById('cardCategory');
            const cardControls = document.querySelector('.card-controls');

            if(totalCardsElement) { totalCardsElement.textContent = currentWordList.length; }

            if (currentWordList.length === 0) {
                if (cardFront) cardFront.textContent = `æ‰€æœ‰å•è¯å·²å­¦å®Œï¼ğŸ‰`;
                if (cardBack) cardBack.innerHTML = '<p class="definition">è¯·åœ¨åˆ—è¡¨æ¨¡å¼ä¸­é‡ç½®è¯æ±‡ã€‚</p>';
                if (cardCount) cardCount.textContent = '0';
                if (cardCategory) cardCategory.textContent = 'æ— å•è¯å¯å¤ä¹ ';
                if (markLearnedBtn) markLearnedBtn.style.display = 'none';
                if (cardControls) cardControls.style.display = 'none';
                return false; 
            }
            
            if (markLearnedBtn) markLearnedBtn.style.display = 'inline-block';
            if (cardControls) cardControls.style.display = 'block';
            return true; 
        };

        const initFlashcardMode = () => {
            if (prepareFlashcards()) {
                flipCard(false); 
                renderCard();
            }
        };

        const renderCard = () => { 
             if (currentWordList.length === 0) return; 
            
            const word = currentWordList[currentCardIndex];
            const front = document.getElementById('cardFront');
            const back = document.getElementById('cardBack');
            const cardCount = document.getElementById('cardCount');
            const cardCategory = document.getElementById('cardCategory');

            if (front) front.textContent = word.word;
            
            if (back) {
                back.innerHTML = `
                    <p style="font-size: 1.2em; font-weight: bold; color: #8a2be2;">ã€${word.pos}ã€‘${word.def}</p>
                    <p class="pron">å‘éŸ³ï¼š${word.pron}</p>
                    <p class="example" style="font-style: italic;">ä¾‹å¥ï¼š${word.example}</p>
                    ${word.confusable ? `<p style="font-size: 0.9em; color: #ff69b4; margin-top: 10px;">æ˜“æ··æ·†è¯ï¼š${word.confusable}</p>` : ''}
                `;
            }

            if (cardCount) cardCount.textContent = currentCardIndex + 1;
            if (cardCategory) cardCategory.textContent = `åˆ†ç±»ï¼š${word.category}`;
        };
        const flipCard = (shouldFlip = true) => { 
             const card = document.querySelector('.flashcard');
            if (card) {
                if (shouldFlip) {
                    card.classList.toggle('flipped');
                } else {
                    card.classList.remove('flipped');
                }
            }
        };
        const nextCard = () => { 
            if (currentWordList.length === 0) return;
            flipCard(false); 
            currentCardIndex = (currentCardIndex + 1) % currentWordList.length;
            renderCard();
        };

        const prevCard = () => { 
             if (currentWordList.length === 0) return;
            flipCard(false); 
            currentCardIndex = (currentCardIndex - 1 + currentWordList.length) % currentWordList.length;
            renderCard();
        };
        
        const markCardAsLearned = () => { 
             if (currentWordList.length === 0) return;
            const word = currentWordList[currentCardIndex].word;
            markAsLearned(word);
            // refreshCurrentMode ä¼šé‡æ–°è°ƒç”¨ initFlashcardModeï¼Œè‡ªåŠ¨å¤„ç†åˆ—è¡¨æ›´æ–°å’Œè·³è½¬
        };


        // --- 3. å¬å†™æµ‹è¯•æ¨¡å¼åŠŸèƒ½ ---

        const updateQuizScore = () => { 
            document.getElementById('scoreCorrect').textContent = scoreCorrect;
            document.getElementById('scoreTotal').textContent = scoreTotal;
        };

        const initQuizMode = () => {
            if (!prepareFlashcards()) { 
                document.getElementById('quizInstruction').textContent = `æ‰€æœ‰å•è¯å·²å­¦å®Œï¼Œæ²¡æœ‰æ–°çš„å•è¯å¯ä»¥æµ‹è¯•ï¼`;
                document.getElementById('quizSpeakBtn').style.display = 'none';
                document.getElementById('quizInput').style.display = 'none';
                document.getElementById('quizSubmitBtn').style.display = 'none';
                document.getElementById('quizNextBtn').style.display = 'none';
                document.getElementById('quizCategory').textContent = 'æ— å•è¯å¯å¤ä¹ ';
                return;
            }
            
            scoreCorrect = 0;
            scoreTotal = 0;
            updateQuizScore();
            document.getElementById('quizFeedback').textContent = '';
            document.getElementById('quizInput').value = '';

            document.getElementById('quizSpeakBtn').style.display = 'inline-block';
            document.getElementById('quizInput').style.display = 'inline-block';
            document.getElementById('quizSubmitBtn').style.display = 'inline-block';
            document.getElementById('quizNextBtn').style.display = 'none';

            nextQuiz();
        };

        const nextQuiz = () => { 
            const total = currentWordList.length;
            if (total === 0) {
                 initQuizMode(); 
                 return;
            }
            currentCardIndex = (currentCardIndex + 1) % total;
            const word = currentWordList[currentCardIndex];
            document.getElementById('quizInstruction').textContent = 'ç‚¹å‡»æŒ‰é’®å¬å•è¯ï¼š';
            document.getElementById('quizCategory').textContent = `åˆ†ç±»ï¼š${word.category}`;
            document.getElementById('quizInput').value = '';
            document.getElementById('quizInput').style.backgroundColor = 'white';
            document.getElementById('quizFeedback').textContent = '';
            document.getElementById('quizSubmitBtn').style.display = 'inline-block';
            document.getElementById('quizNextBtn').style.display = 'none';
            speak(word.word);
        };

        const checkQuizAnswer = () => { 
            const input = document.getElementById('quizInput').value.trim();
            const currentWordObj = currentWordList[currentCardIndex];
            const correctWord = currentWordObj.word;
            const feedback = document.getElementById('quizFeedback');
            const submitBtn = document.getElementById('quizSubmitBtn');
            const nextBtn = document.getElementById('quizNextBtn');
            const inputField = document.getElementById('quizInput');

            if (input === '') {
                feedback.textContent = 'è¯·è¾“å…¥ç­”æ¡ˆï¼';
                feedback.style.color = '#e74c3c';
                return;
            }
            scoreTotal++;
            if (input.toLowerCase() === correctWord.toLowerCase()) {
                scoreCorrect++;
                feedback.innerHTML = `âœ… **æ­£ç¡®ï¼** å•è¯æ˜¯ï¼š${correctWord} ( ${currentWordObj.pron} )`;
                feedback.style.color = '#ff69b4';
                inputField.style.backgroundColor = '#f7f7f7';
                
                markAsLearned(correctWord);
            } else {
                feedback.innerHTML = `âŒ **é”™è¯¯ã€‚** æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š**${correctWord}** ( ${currentWordObj.pron} )`;
                feedback.style.color = '#8a2be2';
                inputField.style.backgroundColor = '#fef0fe';
            }
            submitBtn.style.display = 'none';
            nextBtn.style.display = 'inline-block';
            updateQuizScore();
        };

        // --- 4. æ˜“æ··æ·†è¯é…å¯¹æ¨¡å¼åŠŸèƒ½ ---
        const renderMatchList = () => {
            const container = document.getElementById('matchListContainer');
            if (!container) return;
            
            // ä½¿ç”¨æœªå­¦è¯æ±‡åˆ—è¡¨ï¼Œå¹¶ç­›é€‰å‡ºæœ‰æ˜“æ··æ·†è¯çš„æ¡ç›®
            const wordsToMatch = currentWordList.filter(w => w.confusable && w.confusable.trim() !== '');

            if (wordsToMatch.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: #8a2be2; font-weight: bold;">å½“å‰æœªå­¦è¯æ±‡ä¸­æ²¡æœ‰å¯é…å¯¹çš„æ˜“æ··æ·†è¯ï¼Œæˆ–å·²å…¨éƒ¨å­¦å®Œï¼</p>`;
                return;
            }
            
            let html = '';
            wordsToMatch.forEach(word => {
                const cleanWord = word.word.replace(/'/g, "\\'");
                html += `
                    <div class="match-card">
                        <p><strong>${word.word}</strong> <span style="font-size: 0.9em; color: #7f8c8d;">(${word.pos})</span></p>
                        <p>ä¸­æ–‡: ${word.def}</p>
                        <p>æ˜“æ··æ·†è¯: <em>${word.confusable}</em></p>
                        <button class="learn-btn" onclick="speak('${cleanWord}')" style="margin-top: 5px;">ğŸ”Š å¬å‘éŸ³</button>
                        <button class="learn-btn" onclick="markAsLearned('${cleanWord}')" style="margin-top: 5px; background-color: #ff69b4;">âœ… æ ‡è®°å­¦ä¼š</button>
                    </div>
                `;
            });
            container.innerHTML = html; 
        };
        
        const initMatchMode = () => {
            renderMatchList();
        };


        // --- 5. å® ç‰©é¢†å…»æŒ‘æˆ˜åŠŸèƒ½ ---

        const initDogGame = () => {
            dogBones = 0;
            dogGameReviewWord = null;
            document.getElementById('dogGameFeedback').textContent = '';
            document.getElementById('dogGameInput').value = '';

            // 1. ä½¿ç”¨æœªå­¦è¯æ±‡åˆ—è¡¨
            dogQuizList = [...currentWordList]; 
            
            if (dogQuizList.length === 0) {
                document.getElementById('dogStatus').textContent = `æŒ‘æˆ˜å·²å®Œæˆï¼`;
                document.getElementById('dogMood').textContent = 'å°ç‹—å¾ˆæ»¡è¶³ï¼Œè¯·é‡ç½®è¯æ±‡å§ï¼';
                document.getElementById('dogGameQuestion').textContent = 'ğŸ‰ æ²¡æœ‰å•è¯å¯å–‚é£Ÿï¼';
                document.getElementById('dogGameSubmitBtn').style.display = 'none';
                document.getElementById('dogGameNextBtn').style.display = 'none';
                updateDogVisuals();
                return;
            }
            
            document.getElementById('dogGameSubmitBtn').style.display = 'inline-block';
            document.getElementById('dogGameNextBtn').style.display = 'none';

            // 2. æ‰“ä¹±é¡ºåº
            for (let i = dogQuizList.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [dogQuizList[i], dogQuizList[j]] = [dogQuizList[j], dogQuizList[i]];
            }
            dogQuizIndex = -1;
            updateDogVisuals();
            
            if (dogQuizList.length > 0) {
                nextDogGameQuestion();
            }
        };

        const updateDogVisuals = () => { 
             const dogAvatar = document.getElementById('dogAvatar');
            const dogMood = document.getElementById('dogMood');
            const dogStatus = document.getElementById('dogStatus');
            const boneCount = document.getElementById('boneCount');
            if (!dogAvatar || !dogMood || !dogStatus) return;
            boneCount.textContent = dogBones;
            
            dogAvatar.classList.remove('happy', 'sad');

            if (dogBones === 0) {
                dogAvatar.textContent = 'ğŸ•';
                dogMood.textContent = 'å°ç‹—å¾ˆå…´å¥‹ï¼Œä½†è‚šå­æœ‰ç‚¹é¥¿...';
                dogStatus.textContent = 'ğŸš åŠªåŠ›ç­”é¢˜èµšç‹—ç²®ï¼';
            } else if (dogBones < 10) {
                dogAvatar.textContent = 'ğŸ¶';
                dogMood.textContent = `å°ç‹—åƒäº† ${dogBones} ä»½ç‹—ç²®ï¼Œå¿ƒæƒ…å¾ˆä¸é”™ï¼`;
                dogStatus.textContent = 'å¹²å¾—æ¼‚äº®ï¼ç»§ç»­å–‚é£Ÿï¼';
                dogAvatar.classList.add('happy');
            } else {
                dogAvatar.textContent = 'ğŸ•â€ğŸ¦º';
                dogMood.textContent = `ğŸ¥³ å°ç‹—è¶…çº§æ»¡è¶³ï¼æ€»å…± ${dogBones} ä»½ç‹—ç²®ï¼`;
                dogStatus.textContent = 'ä½ çœŸæ˜¯ä¸ªä¼˜ç§€çš„å®¶é•¿ï¼';
                dogAvatar.classList.add('happy');
            }
        };

        const nextDogGameQuestion = () => { 
             if (dogQuizList.length === 0) {
                initDogGame(); 
                return;
             }
            dogQuizIndex = (dogQuizIndex + 1) % dogQuizList.length;
            const question = dogQuizList[dogQuizIndex];
            currentDogWord = question; 
            
            const questionText = `ã€${question.category}ã€‘è¯·æ ¹æ®ä¸­æ–‡é‡Šä¹‰ **${question.def}** (${question.pos})ï¼Œæ‹¼å†™å‡ºæ­£ç¡®çš„è‹±æ–‡å•è¯ã€‚`;
            const memorizeBtn = document.getElementById('memorizeWordBtn');
            const reviewArea = document.getElementById('wordReviewArea');

            if (memorizeBtn) memorizeBtn.style.display = 'none';
            if (reviewArea) reviewArea.style.display = 'none';
            
            document.getElementById('dogGameQuestion').innerHTML = questionText;
            document.getElementById('dogGameInput').value = '';
            document.getElementById('dogGameInput').placeholder = 'åœ¨æ­¤è¾“å…¥è‹±æ–‡å•è¯æ‹¼å†™';
            document.getElementById('dogGameInput').style.backgroundColor = 'white';
            document.getElementById('dogGameInput').style.color = '#1a1a1a';
            document.getElementById('dogGameFeedback').textContent = '';
            document.getElementById('dogGameFeedback').style.color = '#1a1a1a';
            document.getElementById('dogGameSubmitBtn').style.display = 'inline-block';
            document.getElementById('dogGameNextBtn').style.display = 'none';
            dogGameErrorCount = 0; 
        };

        const checkDogGameAnswer = () => { 
             if (!currentDogWord) return;

            const input = document.getElementById('dogGameInput').value.trim();
            const correctWord = currentDogWord.word;
            const feedback = document.getElementById('dogGameFeedback');
            const submitBtn = document.getElementById('dogGameSubmitBtn');
            const nextBtn = document.getElementById('dogGameNextBtn');

            if (input.toLowerCase() === correctWord.toLowerCase()) {
                dogBones++;
                updateDogVisuals();
                feedback.innerHTML = `âœ… **æ‹¼å†™æ­£ç¡®ï¼** ( +1 ç‹—ç²®!) å•è¯æ˜¯ï¼š${correctWord} ( ${currentDogWord.pron} )`;
                feedback.style.color = '#ff69b4'; 
                document.getElementById('dogGameInput').style.backgroundColor = '#f7f7f7';
                submitBtn.style.display = 'none';
                nextBtn.style.display = 'inline-block';
                document.getElementById('memorizeWordBtn').style.display = 'none';
                
                markAsLearned(correctWord);
            } else {
                dogGameErrorCount++;
                document.getElementById('dogAvatar').classList.add('sad');
                feedback.textContent = `âŒ **é”™è¯¯ï¼** è¯·å†è¯•ä¸€æ¬¡ã€‚`;
                feedback.style.color = '#8a2be2'; 
                
                if (dogGameErrorCount >= 2) {
                    feedback.innerHTML = `âŒ **é”™è¯¯ (${dogGameErrorCount} æ¬¡)ã€‚** æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š**${correctWord}** ( ${currentDogWord.pron} )`;
                    document.getElementById('dogGameInput').style.backgroundColor = '#fef0fe';
                    submitBtn.style.display = 'none';
                    nextBtn.style.display = 'inline-block';
                    dogGameReviewWord = currentDogWord;
                    document.getElementById('memorizeWordBtn').style.display = 'inline-block';
                }
            }
        };

        const toggleDogReview = () => { 
             const reviewArea = document.getElementById('wordReviewArea');
            const content = document.getElementById('reviewContent');
            if (!dogGameReviewWord) return;

            if (reviewArea.style.display === 'none' || reviewArea.style.display === '') {
                content.innerHTML = `
                    <p><strong>è‹±æ–‡å•è¯ï¼š</strong>${dogGameReviewWord.word} <span>${dogGameReviewWord.pron}</span></p>
                    <p><strong>ä¸­æ–‡é‡Šä¹‰ï¼š</strong>${dogGameReviewWord.def}</p>
                    <p><strong>ä¾‹å¥ï¼š</strong>${dogGameReviewWord.example}</p>
                    ${dogGameReviewWord.confusable ? `<p><strong>æ˜“æ··æ·†è¯ï¼š</strong>${dogGameReviewWord.confusable}</p>` : ''}
                `;
                reviewArea.style.display = 'block';
            } else {
                reviewArea.style.display = 'none';
            }
        };
        
        const handleDogGameKeyPress = (event) => { 
             if (event.key === 'Enter') {
                const submitBtn = document.getElementById('dogGameSubmitBtn');
                const nextBtn = document.getElementById('dogGameNextBtn');
                if (submitBtn.style.display !== 'none') {
                    checkDogGameAnswer();
                } else if (nextBtn.style.display !== 'none') {
                    nextDogGameQuestion();
                }
            }
        };


        // --- 6. Hangman æ¸¸æˆåŠŸèƒ½ (ä¿æŒ V10.5 ä¿®å¤åçš„é€»è¾‘) ---

        const renderHangmanAlphabet = () => { 
            const container = document.getElementById('hangmanAlphabet');
            if (!container) return;
            container.innerHTML = ALPHABET.split('').map(letter => `<button data-letter="${letter}" onclick="handleHangmanGuess('${letter}')">${letter}</button>` ).join('');
        };

        const updateHangmanWordDisplay = () => { 
            const wordDisplay = document.getElementById('hangmanWordDisplay');
            if (!wordDisplay) return;
            let display = '';
            let allGuessed = true;
            
            for (const char of hangmanTargetWord.toUpperCase()) {
                if (ALPHABET.includes(char)) {
                    if (hangmanGuessedLetters.has(char)) {
                        display += char;
                    } else {
                        display += '_';
                        allGuessed = false;
                    }
                } else {
                    display += char; 
                }
                display += ' ';
            }
            wordDisplay.textContent = display.trim();

            if (allGuessed && hangmanTargetWord.toUpperCase().split('').some(c => ALPHABET.includes(c))) {
                endHangmanGame(true);
            }
        };

        const updateHangmanDrawing = () => { 
            HANGMAN_PARTS_IDS.forEach(id => {
                const part = document.getElementById(id);
                if(part) part.style.display = 'none';
            });
            for (let i = 0; i < hangmanMistakes; i++) {
                const part = document.getElementById(HANGMAN_PARTS_IDS[i]);
                if(part) part.style.display = 'block';
            }
            if (hangmanMistakes >= HANGMAN_MAX_MISTAKES) {
                endHangmanGame(false);
            }
        };

        const disableHangmanButtons = (disable) => { 
            const buttons = document.querySelectorAll('#hangmanAlphabet button');
            buttons.forEach(btn => {
                btn.disabled = disable || hangmanGuessedLetters.has(btn.dataset.letter);
                if (disable) { 
                    btn.classList.remove('correct', 'incorrect');
                } else if (hangmanGuessedLetters.has(btn.dataset.letter)) {
                    if (hangmanTargetWord.toUpperCase().includes(btn.dataset.letter)) {
                        btn.classList.add('correct');
                    } else {
                        btn.classList.add('incorrect');
                    }
                    btn.disabled = true;
                } else {
                    btn.classList.remove('correct', 'incorrect');
                }
            });
        }
        
        const endHangmanGame = (isWin) => { 
            disableHangmanButtons(true);
            const feedback = document.getElementById('hangmanFeedback');
            const wordDisplay = document.getElementById('hangmanWordDisplay');
            const newGameBtn = document.getElementById('hangmanNewGameBtn');
            
            if (isWin) {
                feedback.innerHTML = 'ğŸ‰ **æ­å–œï¼ä½ æ‹¯æ•‘äº†å°äººï¼**';
                feedback.style.color = '#ff69b4';
                markAsLearned(hangmanTargetWord);
            } else {
                feedback.innerHTML = `ğŸ’€ **å¾ˆé—æ†¾ï¼Œä½ å¤±è´¥äº†ï¼** æ­£ç¡®å•è¯æ˜¯ï¼š**${hangmanTargetWord}**`;
                feedback.style.color = '#8a2be2';
                wordDisplay.textContent = hangmanTargetWord.toUpperCase().split('').join(' ');
            }
            
            if (newGameBtn) newGameBtn.style.display = 'inline-block';
        };

        const handleHangmanGuess = (letter) => { 
            if (hangmanMistakes >= HANGMAN_MAX_MISTAKES || hangmanTargetWord === '' || hangmanGuessedLetters.has(letter)) {
                return;
            }

            hangmanGuessedLetters.add(letter);
            const button = document.querySelector(`#hangmanAlphabet button[data-letter="${letter}"]`);
            if(button) button.disabled = true;
            
            const feedback = document.getElementById('hangmanFeedback');
            
            if (hangmanTargetWord.toUpperCase().includes(letter)) {
                if(button) button.classList.add('correct');
                feedback.textContent = `âœ… å­—æ¯ '${letter}' çŒœå¯¹äº†!`;
                feedback.style.color = '#ff69b4';
            } else {
                hangmanMistakes++;
                if(button) button.classList.add('incorrect');
                feedback.textContent = `âŒ å­—æ¯ '${letter}' çŒœé”™äº†!`;
                feedback.style.color = '#8a2be2';
            }
            updateHangmanWordDisplay();
            updateHangmanDrawing();
        };

        const initHangmanGame = () => {
            renderHangmanAlphabet(); 
            
            // 1. ä½¿ç”¨æœªå­¦çš„è¯æ±‡åˆ—è¡¨ (currentWordList) è¿›è¡Œç­›é€‰
            const suitableWords = currentWordList.filter(w => {
                const word = w.word.toLowerCase();
                // ç­›é€‰å‡ºé€‚åˆ Hangman çš„å•è¯ï¼šåªåŒ…å«å­—æ¯ (æ’é™¤ç¼©å†™ã€ä¸“æœ‰åè¯å’Œå¸¦ç©ºæ ¼çš„çŸ­è¯­), é•¿åº¦é€‚ä¸­ (3-12)
                return word.length >= 3 && word.length <= 12 && /^[a-z]+$/.test(word);
            });
            
            if (suitableWords.length === 0) {
                document.getElementById('hangmanDef').textContent = '(æ— )';
                document.getElementById('hangmanWordDisplay').textContent = 'è¯æ±‡ä¸è¶³';
                document.getElementById('hangmanFeedback').innerHTML = `âš ï¸ å½“å‰æœªå­¦è¯æ±‡ä¸­æ²¡æœ‰é€‚åˆ Hangman æ¸¸æˆçš„å•è¯ (éœ€è¦é•¿åº¦åœ¨3-12ä¸”åªå«å­—æ¯)ï¼Œæˆ–å·²å…¨éƒ¨å­¦å®Œï¼`;
                disableHangmanButtons(true); 
                document.getElementById('hangmanNewGameBtn').style.display = 'inline-block';
                return; 
            }
            
            // éšæœºé€‰æ‹©ä¸€ä¸ªå•è¯
            const wordData = suitableWords[Math.floor(Math.random() * suitableWords.length)];
            hangmanTargetWord = wordData.word.toUpperCase();
            hangmanDef = wordData.def;
            hangmanMistakes = 0;
            hangmanGuessedLetters = new Set();

            // 2. æ¸²æŸ“ç•Œé¢
            document.getElementById('hangmanDef').textContent = hangmanDef;
            document.getElementById('hangmanFeedback').textContent = 'å¼€å§‹çŒœå•è¯ï¼';
            document.getElementById('hangmanNewGameBtn').style.display = 'none';
            document.getElementById('hangmanPronounceBtn').onclick = () => speak(hangmanTargetWord);
            
            // 3. å¯ç”¨æŒ‰é’®å¹¶æ›´æ–°æ˜¾ç¤º
            disableHangmanButtons(false);
            updateHangmanWordDisplay();
            updateHangmanDrawing(); 
        };

        // --- åˆå§‹åŒ–å’Œäº‹ä»¶ç»‘å®š ---
        document.addEventListener('DOMContentLoaded', () => {
            
            // 1. åŠ è½½æ•°æ®å¹¶åˆå§‹åŒ–æ‰å¹³åŒ–åˆ—è¡¨
            loadWordStatus();
            flattenAndInitializeWords(); 
            
            // 2. æ›´æ–°é¡¶éƒ¨çš„å­¦ä¹ æ‘˜è¦
            updateOverallSummary();
            
            // 3. ç»‘å®šæ¨¡å¼åˆ‡æ¢æŒ‰é’® (ä¿æŒä¸å˜)
            document.getElementById('listViewBtn').addEventListener('click', () => { showView('listView'); renderVocabularyList(); });
            document.getElementById('flashcardBtn').addEventListener('click', () => { showView('flashcardView'); initFlashcardMode(); });
            document.getElementById('quizModeBtn').addEventListener('click', () => { showView('quizView'); initQuizMode(); });
            document.getElementById('matchModeBtn').addEventListener('click', () => { showView('matchView'); initMatchMode(); });
            document.getElementById('dogGameBtn').addEventListener('click', () => { showView('dogGameView'); initDogGame(); });
            document.getElementById('hangmanModeBtn').addEventListener('click', () => { showView('hangmanView'); initHangmanGame(); });

            // 4. ç»‘å®šå¡ç‰‡ã€æµ‹éªŒã€æ¸¸æˆæŒ‰é’® (ä¿æŒä¸å˜)
            document.getElementById('prevCardBtn').addEventListener('click', prevCard);
            document.getElementById('nextCardBtn').addEventListener('click', nextCard);
            document.getElementById('quizSpeakBtn').addEventListener('click', () => { if (currentWordList.length > 0 && currentCardIndex > -1) { speak(currentWordList[currentCardIndex].word); } });
            document.getElementById('quizSubmitBtn').addEventListener('click', checkQuizAnswer);
            document.getElementById('quizNextBtn').addEventListener('click', nextQuiz);
            document.getElementById('quizInput').addEventListener('keypress', (event) => { if (event.key === 'Enter') { document.getElementById('quizSubmitBtn').style.display !== 'none' ? checkQuizAnswer() : document.getElementById('quizNextBtn').style.display !== 'none' ? nextQuiz() : null; } });
            document.getElementById('dogGameSubmitBtn').addEventListener('click', checkDogGameAnswer);
            document.getElementById('dogGameNextBtn').addEventListener('click', nextDogGameQuestion);
            document.getElementById('dogGameInput').addEventListener('keypress', handleDogGameKeyPress);
            document.getElementById('hangmanNewGameBtn').addEventListener('click', initHangmanGame);
            
            // 5. åˆå§‹åŠ è½½ï¼šæ˜¾ç¤ºåˆ—è¡¨æ¨¡å¼
            renderVocabularyList();
            showView('listView'); 
        });
    </script>
</body>
</html>